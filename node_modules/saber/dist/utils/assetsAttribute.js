"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
const saber_utils_1 = require("saber-utils");
/**
 * It's considered external resource
 * When it's an absolute url or starting with `/`
 * `/path` is used to reference files in static folder
 */
const isExternal = (str) => saber_utils_1.isAbsoluteUrl(str) || str.startsWith('/');
const MARK = '@@!!SABER_ASSET_MARK_e5968b9a!!@@';
const MARK_GLOBAL_RE = new RegExp(`"${MARK}([^"]+)"`, 'g');
/**
 * Prefix MARK to asset path
 */
const prefixAssets = (assets, cwd) => {
    const result = {};
    for (const key of Object.keys(assets)) {
        const value = assets[key];
        if (!isExternal(value) && !value.startsWith(MARK)) {
            const path = value.startsWith('@')
                ? value
                : value.startsWith('module:')
                    ? value.slice(7)
                    : saber_utils_1.slash(path_1.join(cwd, value));
            result[key] = `${MARK}${path}`;
        }
        else {
            result[key] = value;
        }
    }
    return result;
};
exports.prefixAssets = prefixAssets;
/**
 * Replace strings starting with the MARK to `require` call
 */
const requireAssets = (str) => str.replace(MARK_GLOBAL_RE, (_, p1) => {
    return `require("${p1}")`;
});
exports.requireAssets = requireAssets;
